---
import rssParser from 'rss-parser';
import { getCollection } from 'astro:content';
import Center from '../components/Center.astro';

import BaseLayout from '../layouts/BaseLayout.astro';

const parser = new rssParser();

const feed = await parser.parseURL('');
const substackPosts =  feed.items.map(post =>  ({
    title: post.title,
    description: post.contentSnippet,
    link: post.link,
    date: new Date(post.pubDate),
    source: 'substack'
}));

const astroPosts = await getCollection('blog').map(post => ({
    title: post.data.title,
    description: post.data.description,
    link: `/blog/${post.slug}`,
    date: post.data.date,
    source: 'astro'
}));

const allPosts = [...astroPosts, ...substackPosts].sort((a, b) => b.date - a.date); 
---

<BaseLayout>
    <Center>
        <h1>Blog</h1>
        <p>hey there!</p>
        <section>
            {allPosts.map(post => (
                <article class="post">
                    <h2>
                        <a href={post.link} target={post.source}></a>
                    </h2>
                </article>
            ))}
        </section>
    </Center>
</BaseLayout>